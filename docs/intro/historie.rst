Historie
========

Das Multifunktionsdisplay OBP60 V2 gibt es jetzt in einer zweiten neueren Version. Viele fragen sich warum das notwendig war, zumal das alte OPB60 doch funktionsfähig ist. Das alte OBP60 war so angelegt, dass mit Erweiterungsmodulen wie ESP32, E-Ink Display, GPS und Umgebungssensor gearbeitet wurde. Die Module werden mit durchsteckbaren Steckerleisten auf der Basisplatine eingelötet. In Summe sind das ca. 60 Lötpunkte die manuelle verlötet werden mussten. Teilweise sind die Module nur einseitig mit Steckleisten versehen und müssen beim Löten abgestützt werden. Auch das Display musss vorher angebaut sein, um es verlöten zu können. Für ein Hobbyprojekt mit manueller Bestückung mag das alles okay sein. Für eine Serienfertigung in größeren Stückzahlen ist das aber sehr zeit- und kostenintensiv und nicht mehr mit vertretbarem Aufwand realisierbar. Zudem sind die Module nicht in einer ausreichend gleichbleibenden Qualität zu beziehen und man muss mit großen Qualitätsschwankungen rechnen. Insbesondere beim GPS- und beim BME280-Modul gab es große Probleme mit defekten Modulen. Jedes Modul musste vor dem Einbau manuell geprüft werden. Bei Anfragen zu einer Fertigung in China ließen sich die Module nicht über große Bauteildistributoren besorgen und die Logistik wäre sehr aufwändig geworden. Insgesamt hätte es auch keinen Sinn gemacht die Platine ohne Module zu verkaufen, da ein Funktionstest der Platine so nicht möglich gewesen wäre.

Zusätzlich hatte sich herausgestellt, dass auch einige Schaltungsteile nicht richtig funktioniert haben. Die Backup-Versorgung über den GodlCap für den Ausschaltvorgang war zu klein dimensioniert. Die Energiemenge reichte nicht aus, um das E-Ink Display beim Ausschalten zu löschen und in einen definierten Zustand zu versetzen. Das wiederum hatte auch Folgeprobleme beim Einschalten des E-Ink Displays. Auch die 3,3V Stromversorgung für das BME280 Modul reichte nicht aus, um das Modul sicher betreiben zu können. Nach einiger Zeit im laufenden Betrieb erhöhte sich die Eigenerwärmung und das Modul fiel aus und kommunizierte nur noch fehlerhaft mit der CPU. Durch die umfangreiche Firmware hatten wir auch ein Problem mit dem Arbeitsspeicher. Er war in einigen Situationen zu klein, und verursache Reboots des OBP60. Am I2C Bus gab es auch gelegentlich Probleme, wenn externe Komponenten an den Bus angeschlossen wurden. Im realen Einsatz konnten über den I2C Bus externe Störungen anderer Baugruppen rückwärst in das OBP60 einkoppeln. Da der selbe I2C Bus auch andere wichtige Komponenten des OBP60 versorgt, hatte das schwerwiegende Folgen für die Gesamtstabilität des Systems. Mit galvanisch getrennten Bussystemen kann man solche Probleme umgehen. Beim verwendeten GPS-Modul stellte sich heraus, dass die Firmware des Moduls Fehler enthielt. Das Modul hat in bestimmten Situationen bei schlechten GPS-Empfang verstümmelte NMEA0183 Telegramme ausgesendet, die aber eine korrekte Checksumme enthielten. In solchen Situationen ist das OBP60 komplett eingefroren, da der Parser nicht mit den fehlerhaften Daten umgehen konnte. Inzwischen wurde die Firmware des OBP60 so angepasst, dass sie diesen Fehler erkennt und umgehen kann. 

Verständlicherweise war es nicht sinnvoll den OBP60 in der alten Form in größeren Stückzahlen zu verkaufen. Das hätte einfach zu viele Probleme verursacht und wäre logistisch und vom Zeitaufwand her nicht umsetzbar gewesen.

Aus diesen Gründen wurde die Platine komplett neu entwickelt. Ziel des Ganzen war es die Platinen so zu gestalten, dass sie überwiegend mit SMD-Bauelementen vollautomatisch bestückt werden kann und nur sehr wenige durchsteckbare Bauelemente verwendet wurden. So ist es möglich, dass der Platinen-Hersteller die Platinen vollständig automatisiert bestücken kann, ohne das nachher noch manuell gelötet werden muss. Damit lassen sich jetzt beliebige Stückzahlen ohne zusätzlichen Aufwand für mich fertigen. Allein die Programmierung und der Test sind dann noch manuelle Abläufe, die man aber auch noch zum Fertiger auslagern kann, wenn man das zugehörige Test-Equipment zur Verfügfung stellt.

Bei der Neuentwicklung wurden auch einige Funktionen weggelassen, die sich als überflüssig herausgestellt hatten. Der SeaTalk Bus wird nur noch ganz selten eingesetzt. Beim BME280 machte es keinen Sinn die Luftfeuchtigkeit im inneren des Gerätes zu testen. Zwischenzeitlich gab es auch massive Beschaffungsprobleme des Bosch-Sensors und der Preis war in eine unakzeptable Höhe geschossen. Der BME280 wurde durch den BMP280 ersetzt, der nur noch den Luftdruck und die Temperatur misst. Zudem lässt er sich auch wesentlich besser beschaffen und ist auch deutlich günstiger. Das GPS-Modul wurde komplett entfernt und direkt alle Bauelemente auf der Platine platziert. Es werden jetzt qualitativ hochwertige GPS-Chips chinesischer Bauart verwendet, die gut beschaffbar und günstig sind. Bei den Bussystemen wurde der I2C-Bus, der NMEA2000-Bus und der NMEA0183-Bus galvanisch isoliert ausgeführt, um die Einkopplung störender Einflüsse zu reduzieren. Alle drei Bussysteme sind gegen Überspannungen, Verpolung und gegen Überstrom gesichert. Es gibt jetzt auch spezielle Anschlüsse, auf die die Leitungsschirmung aufgelegt werden kann. Diese ist gegen Überspannungen bis 8kV gesichert. Ein isolierender DC/DC-Wandler stellt für den Nutzer eine 5V-Versorgung mit 200 mA bereit mit der externe Schaltungen potenzialfrei versorgt werden können. Damit lassen sich z.B. mehrere Batterie-Monitore gleichzeitig betreiben oder andere Sensoren einfach anbinden. 

Der Versorgungsspannungseingang wurde ebenfalls gegen Überspannung, Verpolung und gegen Überstrom gesichert. Damit hat man ein ausreichend gute Absicherung auch bei Blitzschlag. Insgesamt sollte die gesamte Schaltung CE-gerecht umgesetzt sein. Das muss aber noch in einem gesonderten Test nachgewiesen werden. Beim 1Wire-Bus wurde auf eine galvanische Isolation verzichtet, da der Bus selbstversorgt ist und keine externe Einspeisung oder Verbindung zu anderen elektrischen Schaltungsteilen benötigt. Mit entsprechender Kabelschirmung ist der 1Wire-Bus ausreichend gesichert.

Die Hintergrundbeleuchtung und die Flash-LED sind jetzt als RGB-LEDs ausgeführt. Damit kann die Farben erzeugen und die Helligkeit für jede LED separat eingestellt werden.

Das E-Ink-Display wurde direkt mit der Hauptplatine verbunden. Dabei schützt eine Trägerplatte das empfindliche Glassubstrat des E-Ink-Displays. Insgesamt ist dadurch der Aufbau kompakter geworden und die Platine und das Display bilden eine Einheit. Durch die geringere Bautiefe können die Abmaße der originalen Raymarine-ST60-Instrumente wieder eingehalten werden.

Die Programmierung des OBP60 gestaltet sich jetzt auch einfacher. Auf der Platine gibt es einen USB-C Steckverbinder, über den das Board programmiert werden kann. Durch die Verwendung des neuen ESP32 S3 entfällt auch der USB-Seriell-Umsetzer. Er ist bereits im ESP32 S3 enthalten. Der USB-C Anschluss ist direkt über die Rückseite des OBP60 erreichbar. Darüber könne auch NMEA0183-Daten bidireiektional übertragen werden. So lassen sich die Daten auch mit einem PC oder Raspberry Pi austauschen. Sofern der USB-Host 5V mit 500mA liefert, kann damit auch das OBP60 betrieben werden. Der ESP32 S3 ist aktuell der leistungsfähigste ESP32 den man bekommen kann. Neben einem größeren RAM verfügt der ESP32 S3 auch über PSRAM womit sich der Arbeitsspeicher noch deutlich erhöhen lässt.